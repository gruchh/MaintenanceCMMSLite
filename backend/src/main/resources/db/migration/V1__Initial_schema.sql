create table breakdown_used_parts (quantity integer not null check (quantity>=1), breakdown_id bigint not null, id bigint generated by default as identity, spare_part_id bigint not null, primary key (id));
create table breakdowns (opened boolean not null, total_cost numeric(19,4), finished_at timestamp(6), id bigint generated by default as identity, machine_id bigint not null, reported_at timestamp(6) not null, started_at timestamp(6), description varchar(1000) not null, specialist_comment varchar(2000), breakdown_type varchar(255) not null check (breakdown_type in ('MECHANICAL','AUTOMATICAL','PARAMETERS')), primary key (id));
create table breakdowns_employees (breakdown_id bigint not null, employee_id bigint not null, primary key (breakdown_id, employee_id));
create table employee_details (contract_end_date date, date_of_birth date not null, hire_date date not null, salary numeric(10,2), id bigint not null, city varchar(255), country varchar(255), education_level varchar(255) check (education_level in ('PRIMARY','SECONDARY','BACHELOR','MASTER','DOCTORATE')), emergency_contact_name varchar(255), emergency_contact_phone varchar(255), field_of_study varchar(255), phone_number varchar(255), postal_code varchar(255), street varchar(255), primary key (id));
create table employee_roles (id bigint generated by default as identity, name varchar(50) not null unique, primary key (id));
create table employees (employee_role_id bigint not null, id bigint not null, primary key (id));
create table machines (production_date date, id bigint generated by default as identity, code varchar(50) not null unique, manufacturer varchar(100), full_name varchar(200) not null, serial_number varchar(255) unique, description oid, primary key (id));
create table spare_parts (price numeric(38,2) not null, id bigint generated by default as identity, name varchar(150) not null unique, producer varchar(150), primary key (id));
create table user_roles (user_id bigint not null, role varchar(255) check (role in ('ADMIN','TECHNICAN','SUBCONTRACTOR')));
create table users (created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), first_name varchar(50) not null, last_name varchar(50) not null, username varchar(50) not null unique, avatar_url varchar(255), email varchar(255) not null unique, password varchar(255) not null, primary key (id));
alter table if exists breakdown_used_parts add constraint FKcwytxxrofd4x5bquhegfae4bd foreign key (breakdown_id) references breakdowns;
alter table if exists breakdown_used_parts add constraint FKp4gu68aofvs2rpo1rmq8gi5a1 foreign key (spare_part_id) references spare_parts;
alter table if exists breakdowns add constraint FKcmwlgwcblt9nwl37dk9twkt8o foreign key (machine_id) references machines;
alter table if exists breakdowns_employees add constraint FK9n09qdriftydkwwu5ri4yf0aw foreign key (employee_id) references employees;
alter table if exists breakdowns_employees add constraint FK93bvc33bdwdfqd154hcqmyamr foreign key (breakdown_id) references breakdowns;
alter table if exists employee_details add constraint FKtlax9cis723ibdj9a43vwq9e foreign key (id) references employees;
alter table if exists employees add constraint FKdah2rhynngctvnn264fv63e9i foreign key (employee_role_id) references employee_roles;
alter table if exists employees add constraint FKd6th9xowehhf1kmmq1dsseq28 foreign key (id) references users;
alter table if exists user_roles add constraint FKhfh9dx7w3ubf1co1vdev94g3f foreign key (user_id) references users;
